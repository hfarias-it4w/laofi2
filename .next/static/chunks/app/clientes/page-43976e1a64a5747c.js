(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4372],{2710:(e,l,r)=>{"use strict";r.r(l),r.d(l,{default:()=>i});var s=r(5155),a=r(6766),t=r(2108),o=r(2115);function i(){let{data:e,status:l}=(0,t.useSession)(),r=null==e?void 0:e.user,[i,n]=(0,o.useState)([]),[d,c]=(0,o.useState)(!1),[m,u]=(0,o.useState)(null),[x,h]=(0,o.useState)({_id:"",email:"",name:"",role:"user",password:""}),[g,p]=(0,o.useState)(!1),b=(0,o.useCallback)(async()=>{c(!0),u(null);try{let e=await fetch("/api/clientes");if(!e.ok)throw Error("Error al obtener usuarios");let l=await e.json();n(l)}catch(e){u(e instanceof Error?e.message:"Error al obtener usuarios")}finally{c(!1)}},[]);(0,o.useEffect)(()=>{(null==r?void 0:r.role)==="admin"&&b()},[b,null==r?void 0:r.role]);let f=async e=>{e.preventDefault(),c(!0),u(null);try{let e;if(!(e=g?await fetch("/api/clientes",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)}):await fetch("/api/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)})).ok){let l=await e.json().catch(()=>null);throw Error((null==l?void 0:l.error)||"Error en la operaci\xf3n")}h({_id:"",name:"",email:"",role:"user",password:""}),p(!1),b()}catch(e){u(e instanceof Error?e.message:"Error en la operaci\xf3n")}finally{c(!1)}},j=async e=>{if(window.confirm("\xbfSeguro que deseas eliminar este usuario?")){c(!0),u(null);try{let l=await fetch("/api/clientes",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({_id:e})});if(!l.ok){let e=await l.json().catch(()=>null);throw Error((null==e?void 0:e.error)||"Error al eliminar")}b()}catch(e){u(e instanceof Error?e.message:"Error al eliminar")}finally{c(!1)}}};return"loading"===l?(0,s.jsx)("div",{className:"text-center mt-10 text-gray-500",children:"Cargando sesi\xf3n..."}):r&&"admin"===r.role?(0,s.jsxs)("div",{className:"flex flex-col items-center flex-grow py-4 px-4 bg-white min-h-screen",children:[(0,s.jsx)(a.default,{src:"/logolaofi.svg",alt:"Logo Laofi",width:120,height:120,className:"mb-6 mt-10 h-20 w-auto"}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-[#3A3A3A] mb-2",children:"Administrador de Clientes"}),(0,s.jsx)("p",{className:"mb-6 text-gray-700",children:"Aqu\xed podr\xe1s gestionar los clientes del sistema."}),(0,s.jsxs)("form",{onSubmit:f,className:"flex flex-col items-center w-full max-w-2xl bg-white rounded-xl shadow-lg px-8 py-8 mb-8",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 w-full",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600 mb-1",htmlFor:"nombre-input",children:"Nombre"}),(0,s.jsx)("input",{id:"nombre-input",type:"text",placeholder:"Nombre",className:"border border-gray-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#13B29F] text-lg",value:x.name,onChange:e=>h(l=>({...l,name:e.target.value})),required:!0,disabled:g})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600 mb-1",htmlFor:"email-input",children:"Email"}),(0,s.jsx)("input",{id:"email-input",type:"email",placeholder:"Email",className:"border border-gray-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#13B29F] text-lg",value:x.email,onChange:e=>h(l=>({...l,email:e.target.value})),required:!0})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600 mb-1",htmlFor:"rol-input",children:"Rol"}),(0,s.jsxs)("select",{id:"rol-input",className:"border border-gray-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#13B29F] text-lg",value:x.role,onChange:e=>h(l=>({...l,role:e.target.value})),children:[(0,s.jsx)("option",{value:"user",children:"Usuario"}),(0,s.jsx)("option",{value:"admin",children:"Admin"})]})]}),!g&&(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600 mb-1",htmlFor:"password-input",children:"Contrase\xf1a"}),(0,s.jsx)("input",{id:"password-input",type:"password",placeholder:"Contrase\xf1a",className:"border border-gray-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#13B29F] text-lg",value:x.password,onChange:e=>h(l=>({...l,password:e.target.value})),required:!0})]})]}),(0,s.jsxs)("div",{className:"mt-6 flex gap-2 w-full justify-center",children:[(0,s.jsx)("button",{type:"submit",className:"bg-[#13B29F] hover:bg-[#119e8d] text-white rounded-xl py-3 px-6 text-lg font-semibold transition-colors disabled:opacity-50",disabled:d,children:g?"Guardar cambios":"Agregar usuario"}),g&&(0,s.jsx)("button",{type:"button",className:"bg-gray-400 text-white rounded-xl py-3 px-6 text-lg font-semibold hover:bg-gray-500 transition-colors",onClick:()=>{p(!1),h({_id:"",name:"",email:"",role:"user",password:""})},disabled:d,children:"Cancelar"})]}),m&&(0,s.jsx)("div",{className:"text-red-600 mt-4 w-full text-center",children:m})]}),(0,s.jsx)("div",{className:"overflow-x-auto w-full max-w-2xl",children:(0,s.jsxs)("table",{className:"min-w-full border text-sm rounded-xl overflow-hidden shadow-md bg-white",children:[(0,s.jsx)("thead",{className:"bg-gray-100",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"p-3 border",children:"Nombre"}),(0,s.jsx)("th",{className:"p-3 border",children:"Email"}),(0,s.jsx)("th",{className:"p-3 border",children:"Rol"}),(0,s.jsx)("th",{className:"p-3 border",children:"Acciones"})]})}),(0,s.jsxs)("tbody",{children:[i.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"p-3 border",children:e.name}),(0,s.jsx)("td",{className:"p-3 border",children:e.email}),(0,s.jsx)("td",{className:"p-3 border",children:e.role}),(0,s.jsxs)("td",{className:"p-3 border flex gap-2",children:[(0,s.jsx)("button",{className:"bg-yellow-400 px-3 py-1 rounded-lg text-xs font-semibold hover:bg-yellow-500 transition-colors",onClick:()=>{h({...e,password:""}),p(!0)},disabled:d,children:"Editar"}),(0,s.jsx)("button",{className:"bg-red-600 text-white px-3 py-1 rounded-lg text-xs font-semibold hover:bg-red-700 transition-colors",onClick:()=>j(e._id),disabled:d,children:"Eliminar"})]})]},e._id)),0===i.length&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:5,className:"text-center p-4 text-gray-500",children:"No hay usuarios registrados."})})]})]})})]}):(0,s.jsx)("div",{className:"text-red-600 text-center mt-10",children:"Acceso denegado"})}},6685:(e,l,r)=>{Promise.resolve().then(r.bind(r,2710))}},e=>{e.O(0,[2108,6766,8441,5964,7358],()=>e(e.s=6685)),_N_E=e.O()}]);